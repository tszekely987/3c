<ClarityDBViewQuery>
  <QueryResult code="CMN_SEC_ASSGND_OBJ_PERM_V0">
    <indexes/>
    <text_length>3595</text_length>
    <text>SELECT  -- GROUP RULE
        UG.USER_ID,
        AP.OBJECT_ID,
        AP.OBJECT_INSTANCE_ID,
        PE.PERMISSION_CODE,
        PE.PERMISSION_VALUE
FROM    CMN_SEC_PERM_ELEMENTS PE,
        CMN_SEC_ASSGND_OBJ_PERM AP,
        CMN_SEC_GROUPS PARENT_GROUP,
        CMN_SEC_GROUPS G,
        CMN_SEC_GROUP_FLAT_HIERS H,
        CMN_SEC_USER_GROUPS UG
WHERE   UG.GROUP_ID = H.GROUP_ID
AND     H.GROUP_ID = G.ID
AND     G.IS_ACTIVE = 1
AND     AP.PRINCIPAL_ID = H.PARENT_GROUP_ID
AND     H.PARENT_GROUP_ID = PARENT_GROUP.ID
AND     PARENT_GROUP.IS_ACTIVE = 1
AND     AP.PRINCIPAL_TYPE = 'GROUP'
AND     AP.PERMISSION_ID = PE.PERMISSION_ID
UNION
SELECT  -- USER RULE
        AP.PRINCIPAL_ID USER_ID,
        AP.OBJECT_ID,
        AP.OBJECT_INSTANCE_ID,
        PE.PERMISSION_CODE,
        PE.PERMISSION_VALUE
FROM    CMN_SEC_PERM_ELEMENTS PE,
        CMN_SEC_ASSGND_OBJ_PERM AP
WHERE   AP.PRINCIPAL_TYPE = 'USER'
AND     AP.PERMISSION_ID = PE.PERMISSION_ID
UNION
SELECT   /*+ index(ri,CMN_SEC_RIGHT_U1) */ -- OBS UNIT RULES for principal is user
        OS.PRINCIPAL_ID USER_ID,
        RI.OBJECT_ID,
        OU.INSTANCE_ID OBJECT_INSTANCE_ID,
        RI.PERMISSION_CODE,
        RI.PERMISSION_VALUE
FROM    CMN_SEC_ASSGND_RIGHT OS,
        OBS_UNIT_ENTITIES_V OU,
        CMN_SEC_RIGHT RI
WHERE   OS.PRINCIPAL_TYPE = 'USER'
AND     OS.INSTANCE_TYPE = OU.UNIT_MODE
AND     OS.INSTANCE_ID = OU.UNIT_ID
AND     RI.RIGHT_ID = OS.RIGHT_ID
AND     RI.IS_ACTIVE = 1
AND     UPPER(OU.TABLE_NAME) = UPPER(RI.RIGHT_OBS_TYPE)
UNION  -- OBS UNIT RULES for principal is group
SELECT   /*+ index(ri,CMN_SEC_RIGHT_U1) */
        UG.USER_ID USER_ID,
        RI.OBJECT_ID,
        OU.INSTANCE_ID OBJECT_INSTANCE_ID,
        RI.PERMISSION_CODE,
        RI.PERMISSION_VALUE
FROM    CMN_SEC_ASSGND_RIGHT OS,
        OBS_UNIT_ENTITIES_V OU,
        CMN_SEC_RIGHT RI,
        CMN_SEC_USER_GROUPS UG,
        CMN_SEC_GROUPS G
WHERE   OS.PRINCIPAL_TYPE = 'GROUP'
AND     OS.PRINCIPAL_ID = UG.GROUP_ID
AND     OS.INSTANCE_TYPE = OU.UNIT_MODE
AND     OS.INSTANCE_ID = OU.UNIT_ID
AND     RI.IS_ACTIVE = 1
AND     G.ID = UG.GROUP_ID
AND     G.IS_ACTIVE = 1
AND     UPPER(OU.TABLE_NAME) = UPPER(RI.RIGHT_OBS_TYPE)
AND     OS.RIGHT_ID = RI.RIGHT_ID
UNION  -- OBS UNIT RULES FOR PRINCIPAL IS OBS, to an instance
SELECT  /*+ index(ri,CMN_SEC_RIGHT_U1) */
        R.USER_ID USER_ID,
        RI.OBJECT_ID,
        OS.INSTANCE_ID OBJECT_INSTANCE_ID,
        RI.PERMISSION_CODE,
        RI.PERMISSION_VALUE
FROM    CMN_SEC_RIGHT RI,
        CMN_SEC_ASSGND_RIGHT OS,
        OBS_UNIT_ENTITIES_V OU,
        SRM_RESOURCES R
WHERE   OU.INSTANCE_ID = R.ID
AND     UPPER(OU.TABLE_NAME) = 'SRM_RESOURCES'
AND     OS.PRINCIPAL_TYPE = OU.UNIT_MODE
AND     OS.PRINCIPAL_ID = OU.UNIT_ID
AND     OS.INSTANCE_TYPE = 'INSTANCE'
AND     OS.RIGHT_ID = RI.RIGHT_ID
AND     RI.IS_ACTIVE = 1
UNION  -- OBS UNIT RULES FOR PRINCIPAL IS OBS, to whole OBS
SELECT /*+ index(ri,CMN_SEC_RIGHT_U1) */
        R.USER_ID USER_ID,
        RI.OBJECT_ID,
        OU2.INSTANCE_ID OBJECT_INSTANCE_ID,
        RI.PERMISSION_CODE,
        RI.PERMISSION_VALUE
FROM    SRM_RESOURCES R,
        OBS_UNIT_ENTITIES_V OU1,
        CMN_SEC_ASSGND_RIGHT OS,
        CMN_SEC_RIGHT RI,
        OBS_UNIT_ENTITIES_V OU2        
WHERE   OU1.INSTANCE_ID = R.ID
AND     UPPER(OU1.TABLE_NAME) = 'SRM_RESOURCES'
AND     OS.PRINCIPAL_TYPE = OU1.UNIT_MODE
AND     OS.PRINCIPAL_ID = OU1.UNIT_ID
AND     OS.INSTANCE_TYPE = OU2.UNIT_MODE
AND     OS.INSTANCE_ID = OU2.UNIT_ID
AND     OS.RIGHT_ID = RI.RIGHT_ID
AND     RI.IS_ACTIVE = 1
AND     UPPER(OU2.TABLE_NAME) = UPPER(RI.RIGHT_OBS_TYPE)</text>
  </QueryResult>
</ClarityDBViewQuery>
