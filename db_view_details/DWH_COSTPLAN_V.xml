<ClarityDBViewQuery>
  <QueryResult code="DWH_COSTPLAN_V">
    <indexes/>
    <text_length>7271</text_length>
    <text>select fin_plans.id odf_pk, FIN_PLANS.ID as clarity_plan_key, FIN_PLANS.ID as plan_key, FIN_COST_PLAN_DETAILS.ID as plan_detail_key, FIN_COST_PLAN_DETAILS.ID as clarity_plan_detail_key, fin_plans.OBJECT_ID as investment_key, fin_plans.NAME as plan_name, fin_plans.CODE as plan_id, fin_plans.DESCRIPTION as description, fin_plans.PERIOD_TYPE_CODE as fiscal_period_type_key, (select NAME from cmn_lookups_v where language_code = dataw_context.language_code and lookup_type = 'PERIOD_TYPE' and rownum = 1 and LOOKUP_CODE = fin_plans.PERIOD_TYPE_CODE) as period_type_code_caption, fin_plans.PLAN_TYPE_CODE as fin_plan_type_key, (select NAME from cmn_lookups_v where language_code = dataw_context.language_code and lookup_type = 'FIN_PLAN_TYPE' and rownum = 1 and LOOKUP_CODE = fin_plans.PLAN_TYPE_CODE) as plan_type_code_caption, ENTITY.HOME_CURRENCY_CODE as home_currency_code, PROJECTS.BILLING_CURRENCY_CODE as billing_currency_code, fin_plans.START_PERIOD_ID as start_period_key, (select CMN_DATE_TRUNC_FCT( start_date ) from biz_com_periods biz_com_periods where biz_com_periods.id = fin_plans.start_period_id) as plan_start_date, fin_plans.END_PERIOD_ID as finish_period_key, (select COP_CALC_FINISH_FCT( end_date) from biz_com_periods biz_com_periods where biz_com_periods.id = fin_plans.end_period_id) as plan_finish_date, fin_plans.IS_PLAN_OF_RECORD as is_plan_of_record, NVL(FIN_PLANS.benefit_plan_id,0) as benefitplan_key, BENEFITPLAN.NAME as benefitplan_name, NVL(FIN_COST_PLAN_DETAILS.charge_code_id,0) as charge_code_key, 
           (select prname from prchargecode where prid = FIN_COST_PLAN_DETAILS.charge_code_id)
       charge_code_id_caption, (select lookup_code from DWH_LOOKUPS_V
                     where
                      id = FIN_COST_PLAN_DETAILS.cost_type_id and lookup_type='LOOKUP_FIN_COSTTYPECODE' and language_code=dataw_context.language_code) as cost_type_key, (select NAME from cmn_lookups_v where language_code = dataw_context.language_code and lookup_type = 'LOOKUP_FIN_COSTTYPECODE' and rownum = 1 and LOOKUP_CODE = (select lookup_code from DWH_LOOKUPS_V
                     where
                      id = FIN_COST_PLAN_DETAILS.cost_type_id and lookup_type='LOOKUP_FIN_COSTTYPECODE' and language_code=dataw_context.language_code)) as cost_type_key_caption, NVL(FIN_COST_PLAN_DETAILS.department_id,0) as department_key, 
         (select dept.shortdesc from departments dept where dept.id = FIN_COST_PLAN_DETAILS.department_id)
       department_id_caption, NVL(FIN_COST_PLAN_DETAILS.location_id,0) as location_key, 
            (select location.shortdesc from locations location where location.id = FIN_COST_PLAN_DETAILS.location_id)
       location_id_caption, NVL(FIN_COST_PLAN_DETAILS.input_type_code_id,0) as input_type_code_key, 
            ( select prtypecode.prname from prtypecode prtypecode where prtypecode.prid = FIN_COST_PLAN_DETAILS.input_type_code_id )
       input_type_code_id_caption, (select lookup_code from DWH_LOOKUPS_V
                     where
                      id = FIN_COST_PLAN_DETAILS.lov1_id and lookup_type='PRTIMEENTRY_USER_LOV1' and language_code=dataw_context.language_code) as user_value1_key, (select NAME from cmn_lookups_v where language_code = dataw_context.language_code and lookup_type = 'PRTIMEENTRY_USER_LOV1' and rownum = 1 and LOOKUP_CODE = (select lookup_code from DWH_LOOKUPS_V
                     where
                      id = FIN_COST_PLAN_DETAILS.lov1_id and lookup_type='PRTIMEENTRY_USER_LOV1' and language_code=dataw_context.language_code)) as user_value1_key_caption, (select lookup_code from DWH_LOOKUPS_V
                    where
                    id = FIN_COST_PLAN_DETAILS.lov2_id and lookup_type='PRTIMEENTRY_USER_LOV2' and language_code = dataw_context.language_code) as user_value2_key, (select NAME from cmn_lookups_v where language_code = dataw_context.language_code and lookup_type = 'PRTIMEENTRY_USER_LOV2' and rownum = 1 and LOOKUP_CODE = (select lookup_code from DWH_LOOKUPS_V
                    where
                    id = FIN_COST_PLAN_DETAILS.lov2_id and lookup_type='PRTIMEENTRY_USER_LOV2' and language_code = dataw_context.language_code)) as user_value2_key_caption, NVL(FIN_COST_PLAN_DETAILS.resource_id,0) as resource_key, 
      (select full_name from srm_resources res where res.id = FIN_COST_PLAN_DETAILS.resource_id)
      resource_id_caption, NVL(FIN_COST_PLAN_DETAILS.role_id,0) as role_key, 
        (select full_name from srm_resources res where res.id = FIN_COST_PLAN_DETAILS.role_id)
      role_id_caption, NVL(FIN_COST_PLAN_DETAILS.resource_class_id,0) as resource_class_key, 
         (select pac_fos_resource_class.description
          from pac_fos_resource_class pac_fos_resource_class
          where pac_fos_resource_class.id = FIN_COST_PLAN_DETAILS.resource_class_id)
       resource_class_id_caption, NVL(FIN_COST_PLAN_DETAILS.transaction_class_id,0) as transaction_class_key, 
         (select transclass.shortdesc from transclass transclass where transclass.id = FIN_COST_PLAN_DETAILS.transaction_class_id)
       transaction_class_id_caption, null as grouping_attributes_key, (
        CASE
        WHEN FIN_COST_PLAN_DETAILS.CREATED_DATE IS NULL AND BENEFITPLAN.CREATED_DATE IS NULL
          THEN FIN_PLANS.CREATED_DATE
        WHEN FIN_COST_PLAN_DETAILS.CREATED_DATE IS NOT NULL AND BENEFITPLAN.CREATED_DATE IS NULL
          THEN GREATEST(FIN_PLANS.CREATED_DATE, FIN_COST_PLAN_DETAILS.CREATED_DATE)
        WHEN FIN_COST_PLAN_DETAILS.CREATED_DATE IS NULL AND BENEFITPLAN.CREATED_DATE IS NOT NULL
          THEN GREATEST(FIN_PLANS.CREATED_DATE, BENEFITPLAN.CREATED_DATE)
        ELSE
          GREATEST(FIN_PLANS.CREATED_DATE, FIN_COST_PLAN_DETAILS.CREATED_DATE, BENEFITPLAN.CREATED_DATE)
        END
      ) as clarity_created_date, (
        CASE
        WHEN FIN_COST_PLAN_DETAILS.LAST_UPDATED_DATE IS NULL AND BENEFITPLAN.LAST_UPDATED_DATE IS NULL
          THEN FIN_PLANS.LAST_UPDATED_DATE
        WHEN FIN_COST_PLAN_DETAILS.LAST_UPDATED_DATE IS NOT NULL AND BENEFITPLAN.LAST_UPDATED_DATE IS NULL
          THEN GREATEST(FIN_PLANS.LAST_UPDATED_DATE, FIN_COST_PLAN_DETAILS.LAST_UPDATED_DATE)
        WHEN FIN_COST_PLAN_DETAILS.LAST_UPDATED_DATE IS NULL AND BENEFITPLAN.LAST_UPDATED_DATE IS NOT NULL
          THEN GREATEST(FIN_PLANS.LAST_UPDATED_DATE, BENEFITPLAN.LAST_UPDATED_DATE)
        ELSE
          GREATEST(FIN_PLANS.LAST_UPDATED_DATE, FIN_COST_PLAN_DETAILS.LAST_UPDATED_DATE, BENEFITPLAN.LAST_UPDATED_DATE)
        END
      ) as clarity_updated_date, dataw_context.language_code, dataw_context.id language_id from fin_plans fin_plans inner join cmn_languages dataw_context on dataw_context.id = dataw_context.id  JOIN inv_investments INVESTMENTS ON INVESTMENTS.id=FIN_PLANS.object_id JOIN pac_mnt_projects PROJECTS ON PROJECTS.id=FIN_PLANS.object_id JOIN entity ENTITY ON ENTITY.entity=INVESTMENTS.entity_code JOIN fin_cost_plan_details FIN_COST_PLAN_DETAILS ON FIN_COST_PLAN_DETAILS.PLAN_ID=FIN_PLANS.ID LEFT OUTER JOIN fin_plans BENEFITPLAN ON FIN_PLANS.BENEFIT_PLAN_ID=BENEFITPLAN.ID  where FIN_PLANS.SUB_PLAN_TYPE = 0
      and ( FIN_PLANS.is_plan_of_record = 1 or 0 = (select FIN_PLANS_POR_ONLY from DWH_SETTINGS) ) and FIN_COST_PLAN_DETAILS.PARENT_DETAIL_ID is null and dataw_context.is_dw_enabled=1</text>
  </QueryResult>
</ClarityDBViewQuery>
