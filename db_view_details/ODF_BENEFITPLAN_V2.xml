<ClarityDBViewQuery>
  <QueryResult code="ODF_BENEFITPLAN_V2">
    <indexes/>
    <text_length>2539</text_length>
    <text>select   'x' pmd_analytical_partition_by, fin_plans.id odf_pk, fin_plans.CODE as code, fin_plans.STATUS_CODE as status_code, fin_plans.START_PERIOD_ID as start_period_id, case when FIN_PLANS.id in (select benefit_plan_id from fin_plans p where p.is_plan_of_record = 1
        and p.object_code = FIN_PLANS.object_code and p.object_id= FIN_PLANS.object_id) then 1 else 0 end as is_plan_of_record, fin_plans.DESCRIPTION as description, INVESTMENTS.NAME as inv_name, (SELECT CASE WHEN count(conv.id) > 0 THEN 1 ELSE 0 END FROM NMC_CONVERSATIONS conv WHERE conv.RESOURCE_NAME = 'benefitplan' AND conv.RESOURCE_ID = FIN_PLANS.ID) as has_conversation, ENTITY.HOME_CURRENCY_CODE as currency_code, fin_plans.END_PERIOD_ID as end_period_id, PERIOD_START_DATE.start_date as start_period_date, fin_plans.TOTAL_ACTUAL_BENEFIT as total_actual_benefit, fin_plans.TOTAL_BILLING_BENEFIT as total_bill_benefit, FIN_PLANS.last_updated_date as last_updated_date, fin_plans.TOTAL_BENEFIT as total_benefit, FIN_PLANS.ID as dw_pk, PROJECTS.BILLING_CURRENCY_CODE as bill_currency_code, (NVL((SELECT 1 FROM DUAL WHERE EXISTS (SELECT 1 from NMC_CONVERSATIONS TC WHERE TC.RESOURCE_NAME='benefitplan' AND TC.RESOURCE_ID = fin_plans.id)), 0)) as has_conversations, ENTITY.ID as entity_id, fin_plans.OBJECT_ID as object_id, CREATED.FULL_NAME as created_by, fin_plans.REVISION as revision, INVESTMENTS.CODE as inv_code, fin_plans.NAME as name, UPDATED.FULL_NAME as updated_by, fin_plans.OBJECT_CODE as object_code, fin_plans.PERIOD_TYPE_CODE as period_type_code, FIN_PLANS.created_date as created_date, odf_ca_benefitplan.partition_code as partition_code, fin_plans.SUB_PLAN_TYPE as sub_plan_type, ENTITY.ENTITY as entity, PERIOD_END_DATE.end_date as finish_period_date  from fin_plans fin_plans JOIN srm_resources CREATED ON CREATED.user_id=FIN_PLANS.created_by JOIN srm_resources UPDATED ON UPDATED.user_id=FIN_PLANS.last_updated_by JOIN inv_investments INVESTMENTS ON INVESTMENTS.id=FIN_PLANS.object_id JOIN pac_mnt_projects PROJECTS ON PROJECTS.id=FIN_PLANS.object_id JOIN entity ENTITY ON ENTITY.entity=INVESTMENTS.entity_code LEFT OUTER JOIN biz_com_periods PERIOD_START_DATE ON PERIOD_START_DATE.period_type = FIN_PLANS.period_type_code and PERIOD_START_DATE.id = FIN_PLANS.start_period_id LEFT OUTER JOIN biz_com_periods PERIOD_END_DATE ON PERIOD_END_DATE.period_type = FIN_PLANS.period_type_code and PERIOD_END_DATE.id = FIN_PLANS.end_period_id JOIN odf_ca_benefitplan odf_ca_benefitplan ON odf_ca_benefitplan.id=fin_plans.id  where FIN_PLANS.SUB_PLAN_TYPE = 1</text>
  </QueryResult>
</ClarityDBViewQuery>
