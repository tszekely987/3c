<ClarityDBViewQuery>
  <QueryResult code="RPT_FIN_BENEFIT_PLANS_V">
    <indexes/>
    <text_length>1931</text_length>
    <text>SELECT A.BENEFIT_PLAN_ID,
       A.PERIOD_NAME,
       A.PERIOD_ID,
       SUM(A.BENEFIT_AMOUNT) BENEFIT_AMOUNT,
       SUM(A.ACT_BENEFIT_AMOUNT) ACT_BENEFIT_AMOUNT
FROM  (SELECT BPD.ID BENEFIT_PLAN_ID,
              FP.PERIOD_NAME,
              FP.ID PERIOD_ID,
              SUM(ROUND(B.SLICE * (B.FINISH_DATE - B.START_DATE),2)) BENEFIT_AMOUNT,
              0 ACT_BENEFIT_AMOUNT
       FROM   FIN_BENEFIT_PLAN_DETAILS BPD, ODF_SSL_BFT_DTL_BFT B, PRJ_BLB_SLICEREQUESTS SR,
              FIN_PLANS P, INV_INVESTMENTS I, ENTITY E, BIZ_COM_PERIODS FP
       WHERE  BPD.ID = B.PRJ_OBJECT_ID
       AND    B.SLICE_REQUEST_ID = SR.ID
       AND    SR.REQUEST_NAME = 'benefitplandetail::benefit::segment'
       AND    BPD.PLAN_ID = P.ID
       AND    P.OBJECT_ID = I.ID
       AND    I.ENTITY_CODE = E.ENTITY
       AND    E.ID = FP.ENTITY_ID
       AND    B.START_DATE BETWEEN FP.START_DATE AND FP.END_DATE-1
       AND    P.PERIOD_TYPE_CODE = FP.PERIOD_TYPE
       GROUP BY BPD.ID, FP.PERIOD_NAME, FP.ID
       UNION
       SELECT BPD.ID BENEFIT_PLAN_ID,
              FP.PERIOD_NAME,
              FP.ID PERIOD_ID,
              0 BENEFIT_AMOUNT,
              SUM(ROUND(B.SLICE * (B.FINISH_DATE - B.START_DATE),2)) ACT_BENEFIT_AMOUNT
       FROM   FIN_BENEFIT_PLAN_DETAILS BPD, ODF_SSL_BFT_DTL_ABFT B, PRJ_BLB_SLICEREQUESTS SR,
              FIN_PLANS P, INV_INVESTMENTS I, ENTITY E, BIZ_COM_PERIODS FP
       WHERE  BPD.ID = B.PRJ_OBJECT_ID
       AND    B.SLICE_REQUEST_ID = SR.ID
       AND    SR.REQUEST_NAME = 'benefitplandetail::actual_benefit::segment'
       AND    BPD.PLAN_ID = P.ID
       AND    P.OBJECT_ID = I.ID
       AND    I.ENTITY_CODE = E.ENTITY
       AND    E.ID = FP.ENTITY_ID
       AND    B.START_DATE BETWEEN FP.START_DATE AND FP.END_DATE-1
       AND    P.PERIOD_TYPE_CODE = FP.PERIOD_TYPE
       GROUP BY BPD.ID, FP.PERIOD_NAME, FP.ID) A
GROUP BY A.BENEFIT_PLAN_ID, A.PERIOD_NAME, A.PERIOD_ID
 
 
 
 
 </text>
  </QueryResult>
</ClarityDBViewQuery>
