<ClarityDBViewQuery>
  <QueryResult code="NBI_PROJECT_RES_TASK_FACTS_N_R">
    <indexes/>
    <text_length>2100</text_length>
    <text>SELECT F.PROJECT_ID PROJECT_ID, 
       F.RESOURCE_ID RESOURCE_ID, 
       F.TEAM_ID TEAM_ID,
       TO_NUMBER(DECODE(F.TASK_ID, -1, NULL, F.TASK_ID)) TASK_ID, 
       F.FACT_DATE FACT_DATE, 
       RCF.OBS1_UNIT_ID OBS1_UNIT_ID, 
       RCF.OBS2_UNIT_ID OBS2_UNIT_ID, 
       RCF.OBS3_UNIT_ID OBS3_UNIT_ID, 
       RCF.OBS4_UNIT_ID OBS4_UNIT_ID, 
       RCF.OBS5_UNIT_ID OBS5_UNIT_ID, 
       CASE WHEN F.TASK_ID = -1 THEN NULL 
            ELSE (SELECT TASK.PRNAME FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID) END TASK_DESCRIPTION, 
       CASE WHEN F.TASK_ID = -1 THEN NULL 
            WHEN ABS((SELECT TASK.PRISMILESTONE FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID)) = 1 THEN 'MILESTONE' 
            WHEN (SELECT TASK.PRWBSLEVEL FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID) = 1 THEN 'PHASE' 
            WHEN (SELECT TASK.PRWBSLEVEL FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID) = 2 THEN 'ACTIVITY' 
            ELSE 'TASK' END TASK_TYPE, 
       DECODE(RCF.IS_ROLE, 1, 0, 1) RESOURCE_TYPE, 
       TEAM.PRROLEID ROLE_ID, 
       ROLE.FULL_NAME ROLE_NAME, 
       CASE WHEN TEAM.PRBOOKING = 15 THEN 1 ELSE 0 END HARDBOOKED, 
       F.ALLOCATED_QTY ALLOCATED_QTY, 
       F.ETC_QTY ETC_QTY, 
       F.ACTUAL_QTY ACTUAL_QTY, 
       F.BASE_QTY BASE_QTY, 
       CASE WHEN (F.TASK_ID = -1 OR (SELECT TASK.PRCHARGECODEID FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID) IS NULL) THEN 
              (SELECT CC.PREXTERNALID 
               FROM PRCHARGECODE CC, INV_INVESTMENTS INV
               WHERE INV.CHARGECODEID = CC.PRID AND INV.ID = F.PROJECT_ID) 
            ELSE 
              (SELECT PREXTERNALID 
               FROM PRCHARGECODE CC 
               WHERE (SELECT TASK.PRCHARGECODEID FROM PRTASK TASK WHERE F.TASK_ID = TASK.PRID) = CC.PRID) 
       END CHARGE_CODE, 
       (SELECT VALUE 
        FROM CMN_OPTION_VALUES 
        WHERE OPTION_ID = 288 ) CURRENCY_CODE 
FROM   NBI_PRT_FACTS F, 
       PRTEAM TEAM, 
       SRM_RESOURCES ROLE, 
       NBI_RESOURCE_CURRENT_FACTS RCF 
WHERE  TEAM.PRID = F.TEAM_ID 
AND    TEAM.PRROLEID = ROLE.ID (+) 
AND    F.RESOURCE_ID = RCF.RESOURCE_ID</text>
  </QueryResult>
</ClarityDBViewQuery>
