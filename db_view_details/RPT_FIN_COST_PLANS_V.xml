<ClarityDBViewQuery>
  <QueryResult code="RPT_FIN_COST_PLANS_V">
    <indexes/>
    <text_length>2819</text_length>
    <text>SELECT A.COST_PLAN_ID,
       A.PERIOD_NAME,
       A.PERIOD_ID,
       SUM(A.UNITS) UNITS,
       SUM(A.COST_AMOUNT) COST_AMOUNT,
       SUM(A.REVENUE_AMOUNT) REVENUE_AMOUNT
FROM  (SELECT CPD.ID COST_PLAN_ID,
              FP.PERIOD_NAME,
              FP.ID PERIOD_ID,
              SUM(ROUND(U.SLICE * (U.FINISH_DATE - U.START_DATE),2)) UNITS,
              0 COST_AMOUNT,
              0 REVENUE_AMOUNT
       FROM   FIN_COST_PLAN_DETAILS CPD, ODF_SSL_CST_DTL_UNITS U, PRJ_BLB_SLICEREQUESTS SR,
              FIN_PLANS P, INV_INVESTMENTS I, ENTITY E, BIZ_COM_PERIODS FP
       WHERE  CPD.ID = U.PRJ_OBJECT_ID
       AND    U.SLICE_REQUEST_ID = SR.ID
       AND    SR.REQUEST_NAME = 'costplandetail::units::segment'
       AND    CPD.PLAN_ID = P.ID
       AND    P.OBJECT_ID = I.ID
       AND    I.ENTITY_CODE = E.ENTITY
       AND    E.ID = FP.ENTITY_ID
       AND    U.START_DATE BETWEEN FP.START_DATE AND FP.END_DATE-1
       AND    P.PERIOD_TYPE_CODE = FP.PERIOD_TYPE
       GROUP BY CPD.ID, FP.PERIOD_NAME, FP.ID
       UNION
       SELECT CPD.ID COST_PLAN_ID,
              FP.PERIOD_NAME,
              FP.ID PERIOD_ID,
              0 UNITS,
              SUM(ROUND(CST.SLICE * (CST.FINISH_DATE - CST.START_DATE),2)) COST_AMOUNT,
              0 REVENUE_AMOUNT
       FROM   FIN_COST_PLAN_DETAILS CPD, ODF_SSL_CST_DTL_COST CST, PRJ_BLB_SLICEREQUESTS SR,
              FIN_PLANS P, INV_INVESTMENTS I, ENTITY E, BIZ_COM_PERIODS FP
       WHERE  CPD.ID = CST.PRJ_OBJECT_ID
       AND    CST.SLICE_REQUEST_ID = SR.ID
       AND    SR.REQUEST_NAME = 'costplandetail::cost::segment'
       AND    CPD.PLAN_ID = P.ID
       AND    P.OBJECT_ID = I.ID
       AND    I.ENTITY_CODE = E.ENTITY
       AND    E.ID = FP.ENTITY_ID
       AND    CST.START_DATE BETWEEN FP.START_DATE AND FP.END_DATE-1
       AND    P.PERIOD_TYPE_CODE = FP.PERIOD_TYPE
       GROUP BY CPD.ID, FP.PERIOD_NAME, FP.ID
       UNION
       SELECT CPD.ID COST_PLAN_ID,
              FP.PERIOD_NAME,
              FP.ID PERIOD_ID,
              0 UNITS,
              0 COST_AMOUNT,
              SUM(ROUND(R.SLICE * (R.FINISH_DATE - R.START_DATE),2)) REVENUE_AMOUNT
       FROM   FIN_COST_PLAN_DETAILS CPD, ODF_SSL_CST_DTL_REV R, PRJ_BLB_SLICEREQUESTS SR,
              FIN_PLANS P, INV_INVESTMENTS I, ENTITY E, BIZ_COM_PERIODS FP
       WHERE  CPD.ID = R.PRJ_OBJECT_ID
       AND    R.SLICE_REQUEST_ID = SR.ID
       AND    SR.REQUEST_NAME = 'costplandetail::revenue::segment'
       AND    CPD.PLAN_ID = P.ID
       AND    P.OBJECT_ID = I.ID
       AND    I.ENTITY_CODE = E.ENTITY
       AND    E.ID = FP.ENTITY_ID
       AND    R.START_DATE BETWEEN FP.START_DATE AND FP.END_DATE-1
       AND    P.PERIOD_TYPE_CODE = FP.PERIOD_TYPE
       GROUP BY CPD.ID, FP.PERIOD_NAME, FP.ID
       ) A
GROUP BY A.COST_PLAN_ID, A.PERIOD_NAME, A.PERIOD_ID
 
 
 </text>
  </QueryResult>
</ClarityDBViewQuery>
