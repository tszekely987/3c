<ClarityDBViewQuery>
  <QueryResult code="COP_INV_RIM_STOPLIGHTS_V">
    <indexes/>
    <text_length>1164</text_length>
    <text>SELECT i.id investment_id,
           MAX(CASE WHEN rim.type_code = 'ISSUE' THEN
                    CASE WHEN rim.priority_code = 'LOW' THEN 1
                         WHEN rim.priority_code = 'MEDIUM' THEN 2
                         WHEN rim.priority_code = 'HIGH' THEN 3
                         ELSE 0 END ELSE 0 END) issue_sl,
           MAX(CASE WHEN rim.type_code = 'RISK' THEN
                    CASE WHEN rim.priority_code = 'LOW' THEN 1
                         WHEN rim.priority_code = 'MEDIUM' THEN 2
                         WHEN rim.priority_code = 'HIGH' THEN 3
                         ELSE 0 END ELSE 0 END) risk_sl,
           MAX(CASE WHEN rim.type_code = 'CHANGE' THEN
                    CASE WHEN rim.priority_code = 'LOW' THEN 1
                         WHEN rim.priority_code = 'MEDIUM' THEN 2
                         WHEN rim.priority_code = 'HIGH' THEN 3
                         ELSE 0 END ELSE 0 END) change_sl
    FROM   inv_investments i
           INNER JOIN rim_risks_and_issues rim ON i.id = rim.pk_id
    WHERE  rim.type_code IN ('ISSUE','RISK','CHANGE')
    AND    rim.status_code NOT IN ('CLOSED','RESOLVED')
    GROUP BY i.id</text>
  </QueryResult>
</ClarityDBViewQuery>
