<ClarityDBViewQuery>
  <QueryResult code="DWH_X_INV_TODO_FACTS_V">
    <indexes/>
    <text_length>616</text_length>
    <text>select investment_key,
    sum(CASE WHEN completed = 0 THEN 1 ELSE 0 END) AS todo_open_count,
    sum(CASE WHEN completed = 0 THEN 0 ELSE 1 END) AS todo_completed_count,
    count(1) AS todo_total_count,
    max(last_updated_date) AS last_updated_date
from (select
        case when assoc.assoc_parent_id is null then assoc.assoc_instance_id else assoc.assoc_parent_id end AS investment_key,
        t.completed as completed,
        t.last_updated_date
        FROM oba_todos t
        JOIN oba_associations assoc ON t.id = assoc.src_instance_id AND assoc.src_object_alias = 'obaTodos'
) a
group by a.investment_key</text>
  </QueryResult>
</ClarityDBViewQuery>
