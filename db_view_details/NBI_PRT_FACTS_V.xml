<ClarityDBViewQuery>
  <QueryResult code="NBI_PRT_FACTS_V">
    <indexes/>
    <text_length>2491</text_length>
    <text>SELECT 	PRTEAM.PRPROJECTID PROJECT_ID,
		PRTEAM.PRRESOURCEID RESOURCE_ID,	
		PRTEAM.PRID TEAM_ID,		
		-1 TASK_ID,
		SLICES.PRJ_OBJECT_ID PRJ_OBJECT_ID,
		SLICES.SLICE_DATE FACT_DATE,
		NVL (SLICES.SLICE, 0) ALLOCATED_QTY,
		TO_NUMBER (NULL) ETC_QTY,
		TO_NUMBER (NULL) ACTUAL_QTY,
		TO_NUMBER (NULL) BASE_QTY		
  FROM 	PRJ_BLB_SLICES SLICES
  JOIN	PRJ_BLB_SLICEREQUESTS SLICEREQUESTS ON (SLICES.SLICE_REQUEST_ID = SLICEREQUESTS.ID AND SLICEREQUESTS.REQUEST_NAME = 'DAILYRESOURCEALLOCCURVE')
  JOIN	PRTEAM PRTEAM ON  PRTEAM.PRID = SLICES.PRJ_OBJECT_ID
  JOIN  INV_INVESTMENTS INVESTMENTS ON PRTEAM.PRPROJECTID = INVESTMENTS.ID
  LEFT OUTER JOIN INV_PROJECTS PROJECTS ON INVESTMENTS.ID=PROJECTS.PRID  
  WHERE NVL(PROJECTS.IS_TEMPLATE,0)=0 AND
   EXISTS (SELECT 1
                    FROM SRM_RESOURCES
                    WHERE SRM_RESOURCES.INCLUDE_FLAG = 1
                    AND PRTEAM.PRRESOURCEID = SRM_RESOURCES.ID)
UNION ALL
SELECT  TASK.PRPROJECTID PROJECT_ID,
        ASSIGNMENT.PRRESOURCEID RESOURCE_ID,  
	    ASSIGNMENT.TEAM_ID,
        TASK.PRID TASK_ID,
        SLICES.PRJ_OBJECT_ID PRJ_OBJECT_ID,
        SLICES.SLICE_DATE FACT_DATE,
        TO_NUMBER (NULL) ALLOCATED_QTY,
        SUM (TO_NUMBER (DECODE (SLICEREQUESTS.REQUEST_NAME,
                 'DAILYRESOURCEESTCURVE', NVL (SLICES.SLICE, 0), 0))
        ) ETC_QTY,
        SUM (TO_NUMBER (DECODE (SLICEREQUESTS.REQUEST_NAME,
                 'DAILYRESOURCEACTCURVE', NVL (SLICES.SLICE, 0), 0))
        ) ACTUAL_QTY,
        SUM (TO_NUMBER (DECODE (SLICEREQUESTS.REQUEST_NAME,
                 'DAILYRESOURCEBASECURVE', NVL (SLICES.SLICE, 0), 0))
        ) BASE_QTY		
 FROM 	PRJ_BLB_SLICES SLICES
 JOIN	PRJ_BLB_SLICEREQUESTS SLICEREQUESTS ON (SLICES.SLICE_REQUEST_ID = SLICEREQUESTS.ID
												AND SLICEREQUESTS.REQUEST_NAME IN ('DAILYRESOURCEACTCURVE','DAILYRESOURCEBASECURVE','DAILYRESOURCEESTCURVE'))
 JOIN 	PRASSIGNMENT ASSIGNMENT  ON ASSIGNMENT.PRID = SLICES.PRJ_OBJECT_ID
 JOIN 	PRTASK TASK ON TASK.PRID = ASSIGNMENT.PRTASKID
 JOIN 	INV_INVESTMENTS INVESTMENTS ON TASK.PRPROJECTID = INVESTMENTS.ID
 LEFT OUTER JOIN INV_PROJECTS PROJECTS ON INVESTMENTS.ID=PROJECTS.PRID 
 WHERE NVL(PROJECTS.IS_TEMPLATE,0)=0 AND
 EXISTS (SELECT 1
                    FROM SRM_RESOURCES
                    WHERE SRM_RESOURCES.INCLUDE_FLAG = 1
                    AND ASSIGNMENT.PRRESOURCEID = SRM_RESOURCES.ID)
GROUP BY TASK.PRPROJECTID,ASSIGNMENT.PRRESOURCEID,ASSIGNMENT.TEAM_ID,TASK.PRID,SLICES.PRJ_OBJECT_ID,SLICES.SLICE_DATE</text>
  </QueryResult>
</ClarityDBViewQuery>
