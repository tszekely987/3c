<?xml version="1.0" encoding="UTF-8" standalone="no"?><QueryResult xmlns="http://www.niku.com/xog/Query" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <Code>capture3c.get_db_trigger</Code>
      <Records>
        <Record>
          <code>SRM_CONTACTS_T1</code>
          <table_name>SRM_CONTACTS</table_name>
          <trigger_type>AFTER EACH ROW</trigger_type>
          <triggering_event>INSERT OR UPDATE</triggering_event>
          <column_name xsi:nil="true"/>
          <referencing_names>REFERENCING NEW AS NEW OLD AS OLD</referencing_names>
          <when_clause xsi:nil="true"/>
          <status>ENABLED</status>
          <description>"PPM"."SRM_CONTACTS_T1" 
AFTER INSERT OR UPDATE
ON SRM_CONTACTS
REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
</description>
          <trigger_body>begin
 if :new.PRINCIPAL_TYPE ='COMPANY_POSTAL'then

 	  DECLARE
	  v_comp_id GLOBALPKG.STRING;
	  v_exist number;
      begin

	  SELECT count(*) INTO v_exist
	  FROM ARMASTER A,
  	   SRM_COMPANIES CM
  	  WHERE :new.PRINCIPAL_ID = CM.ID
  	  and CM.COMPANY_ID = A.COMPANY_CODE;

	  if v_exist=1 then


	  	   SELECT CM.COMPANY_ID INTO v_comp_id
 		   from ARMASTER A,
  		    SRM_COMPANIES CM
  	 	   WHERE :new.PRINCIPAL_ID = CM.ID
  	 	   and CM.COMPANY_ID = A.COMPANY_CODE AND
		   	   A.SRM_ID IS NOT NULL ;

		   UPDATE ARMASTER
		   set ADDR1 = :new.ADDRESS1,
		   ADDR2 =:new.ADDRESS2,
		   ADDR3 =:new.CITY,
		   ADDR4 =:new.STATE_PROVINCE,
		   ADDR5 =(select CMN_COUNTRIES_V.NAME
		   from CMN_COUNTRIES_V , CMN_SEC_USERS , CMN_LANGUAGES
		   WHERE CMN_SEC_USERS.LANGUAGE_ID=CMN_LANGUAGES.ID
		   and  CMN_COUNTRIES_V.LANGUAGE_CODE =CMN_LANGUAGES.LANGUAGE_CODE
		   and CMN_SEC_USERS.id=:new.LAST_UPDATED_BY
		   and CMN_COUNTRIES_V.id= :new.COUNTRY_ID),
		   ADDR6 =:new.POSTAL_CODE,
		   CONTACT_PHONE =:new.PHONE_WORK,
		   ATTENTION_PHONE = :new.PHONE_WORK
		   where ARMASTER.COMPANY_CODE = v_comp_id AND
		   		 ARMASTER.SRM_ID IS NOT NULL ;
	  END IF;
	  end;
END IF;
end;
















































</trigger_body>
        </Record>
      </Records>
      <Slice>
        <Number>0</Number>
        <Size>1</Size>
        <Total>1</Total>
      </Slice>
    </QueryResult>