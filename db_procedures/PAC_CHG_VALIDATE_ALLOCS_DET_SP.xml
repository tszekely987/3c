<?xml version="1.0" encoding="UTF-8" standalone="no"?><QueryResult xmlns="http://www.niku.com/xog/Query" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <Code>capture3c.get_db_procedure</Code>
      <Records>
        <Record>
          <code>PAC_CHG_VALIDATE_ALLOCS_DET_SP</code>
          <parallel>NO</parallel>
          <definition>
  CREATE OR REPLACE EDITIONABLE PROCEDURE "PPM"."PAC_CHG_VALIDATE_ALLOCS_DET_SP" (
  objectId   	  							 NUMBER,
  status  		 						 VARCHAR2,
  p_chargeback_type						 VARCHAR2
)
  AS

v_allocation_percent NUMBER;

UF1_oval1 				PAC_CHG_ALLOCS_DATES.ID%TYPE;
CURSOR UF1_cursor IS
	SELECT PAC_CHG_ALLOCS_DATES.ID
	FROM PAC_CHG_ALLOCS_DATES
	WHERE PAC_CHG_ALLOCS_DATES.ALLOCATION_ID = (SELECT ID FROM PAC_CHG_ALLOCATIONS WHERE 
		  									    ALLOCATION_TYPE = p_chargeback_type and OBJECT_ID = PAC_CHG_VALIDATE_ALLOCS_DET_SP.objectId);
		
BEGIN
	 IF PAC_CHG_VALIDATE_ALLOCS_DET_SP.status = 'ACTIVE' THEN
	 BEGIN
		 v_allocation_percent := 0;
		 OPEN UF1_cursor;
		 LOOP
			 FETCH UF1_cursor INTO UF1_oval1;
			 EXIT WHEN UF1_cursor%NOTFOUND;
			 BEGIN
		  	   	  SELECT SUM(ALLOCATION_PERCENT) INTO v_allocation_percent FROM PAC_CHG_ALLOCS_DETAILS WHERE 
			  	 	  ALLOCATION_DATES_ID = UF1_oval1;
						  
				  IF ( v_allocation_percent &lt;&gt; 100 ) THEN
		 	  	 	 RAISE_APPLICATION_ERROR(-20842, 'Allocation Percentages not totalling to a hundred percent for one or more rules');
				  END IF;
			 END;
		 END LOOP;
		 CLOSE UF1_cursor;
	 END;
	 END IF;
END PAC_CHG_VALIDATE_ALLOCS_DET_SP;
 
 
 
 
 </definition>
        </Record>
      </Records>
      <Slice>
        <Number>0</Number>
        <Size>1</Size>
        <Total>1</Total>
      </Slice>
    </QueryResult>