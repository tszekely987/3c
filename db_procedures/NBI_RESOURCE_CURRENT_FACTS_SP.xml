<?xml version="1.0" encoding="UTF-8" standalone="no"?><QueryResult xmlns="http://www.niku.com/xog/Query" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <Code>capture3c.get_db_procedure</Code>
      <Records>
        <Record>
          <code>NBI_RESOURCE_CURRENT_FACTS_SP</code>
          <parallel>NO</parallel>
          <definition>
  CREATE OR REPLACE EDITIONABLE PROCEDURE "PPM"."NBI_RESOURCE_CURRENT_FACTS_SP" 
IS  
BEGIN
   EXECUTE IMMEDIATE 'TRUNCATE TABLE NBI_RESOURCE_CURRENT_FACTS';
   --COMMIT;
   --CREATE INDEX NBI_CFG_OBS_ASS_N1 ON NBI_CFG_OBS_ASSIGNMENTS (OBS_COLUMN_NAME,OBJECT_TYPE)
   INSERT /*+ APPEND */ INTO NBI_RESOURCE_CURRENT_FACTS
          (  RESOURCE_ID,OBS1_UNIT_ID,OBS2_UNIT_ID,OBS3_UNIT_ID,OBS4_UNIT_ID,OBS5_UNIT_ID,MANAGER_ID,
             MANAGER_LAST_NAME,MANAGER_FIRST_NAME,RESOURCE_COMPANY,RESOURCE_COMPANY_ID,RESOURCE_CODE,
             LAST_NAME,FIRST_NAME,EXTERNAL_OR_INTERNAL,IS_ACTIVE,IS_ROLE,ROLE_ID,ROLE_NAME,ENTITY,
             ENTITY_NAME,LOCATION,LOCATION_NAME,DEPARTMENT,DEPARTMENT_NAME
          )    
	SELECT  /*+ index(RES SRM_RESOURCES_PK) index(RES SRM_RESOURCES_N5) index(RES SRM_RESOURCES_N11) */
			   RES.ID RESOURCE_ID,
               NBI_GET_OBS_ID_FCT ('RESOURCE', RES.ID, 'OBS1_UNIT_ID') OBS1_UNIT_ID,
               NBI_GET_OBS_ID_FCT ('RESOURCE', RES.ID, 'OBS2_UNIT_ID') OBS2_UNIT_ID,
               NBI_GET_OBS_ID_FCT ('RESOURCE', RES.ID, 'OBS3_UNIT_ID') OBS3_UNIT_ID,
               NBI_GET_OBS_ID_FCT ('RESOURCE', RES.ID, 'OBS4_UNIT_ID') OBS4_UNIT_ID,
               NBI_GET_OBS_ID_FCT ('RESOURCE', RES.ID, 'OBS5_UNIT_ID') OBS5_UNIT_ID,
               RES.MANAGER_ID MANAGER_ID,
               MGR.LAST_NAME MANAGER_LAST_NAME,
               MGR.FIRST_NAME MANAGER_FIRST_NAME,
               COMPANY.COMPANY_NAME RESOURCE_COMPANY,
               COMPANY.COMPANY_ID RESOURCE_COMPANY_ID,
               RES.UNIQUE_NAME RESOURCE_CODE,
               RES.LAST_NAME LAST_NAME,
               RES.FIRST_NAME FIRST_NAME,
			   --CLRT-70337 
               RES.IS_EXTERNAL EXTERNAL_OR_INTERNAL,
               RES.IS_ACTIVE,
               RES_ROLE.PRISROLE IS_ROLE,
               ROLE1.ID ROLE_ID,
               ROLE1.LAST_NAME ROLE_NAME,
               ORG.ENTITY ENTITY,
               ORG.ENTITY_NAME ENTITY_NAME,
               ORG.LOCATION LOCATION,
               ORG.LOCATION_NAME LOCATION_NAME,
               ORG.DEPARTMENT DEPARTMENT,
               ORG.DEPARTMENT_NAME DEPARTMENT_NAME              
      FROM     SRM_RESOURCES RES
      LEFT OUTER JOIN CMN_SEC_USERS MGR ON RES.MANAGER_ID = MGR.ID
      LEFT OUTER JOIN CMN_SEC_USERS USERS ON RES.USER_ID = USERS.ID 
      LEFT OUTER JOIN SRM_COMPANIES COMPANY ON USERS.COMPANY_ID = COMPANY.ID
      LEFT OUTER JOIN NBI_RESOURCE_ORG_INFO_V ORG ON RES.ID =ORG.RESOURCE_ID
      LEFT OUTER JOIN PRJ_RESOURCES RES_ROLE ON RES.ID=RES_ROLE.PRID
      LEFT OUTER JOIN SRM_RESOURCES ROLE1 ON    RES_ROLE.PRPRIMARYROLEID = ROLE1.ID  
      WHERE RES.INCLUDE_FLAG = 1;
   --COMMIT;
EXCEPTION
   WHEN OTHERS THEN RAISE_APPLICATION_ERROR (-20000, 'Error in NBI_RESOURCE_CURRENT_FACTS_SP - '  || SQLERRM);
END;</definition>
        </Record>
      </Records>
      <Slice>
        <Number>0</Number>
        <Size>1</Size>
        <Total>1</Total>
      </Slice>
    </QueryResult>