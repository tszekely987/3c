<?xml version="1.0" encoding="UTF-8" standalone="no"?><NikuDataBus xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../xsd/nikuxog_contentPack.xsd">
      <Header action="write" externalSource="NIKU" objectType="contentPack" version="16.1.2.1567"/>
      <contentPack update="true">
        <queries update="true">
          <query category="PRODUCTIVITY" code="cop.qry.schedulePerformance" isUserPortletAvailable="1" source="csk.niku.com">
            
            
            
            
            <nls description="Schedule Performance" languageCode="en" name="Schedule Performance"/>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <nsql dbId="Niku" dbVendor="all"><![CDATA[SELECT @select:dim:user_def:implied:task:schedPerf.lookup_code:category_code@,
       @select:dim_prop:user_def:implied:task:schedPerf.cat_name:category@,
       @select:dim_prop:user_def:implied:task:schedPerf.desc_name:cat_desc@,
       @select:dim_prop:user_def:implied:task:schedPerf.as_of_date:asOfDate@,
       @select:dim_prop:user_def:implied:task:schedPerf.number_of_days:noOfDays@,
       @select:dim_prop:user_def:implied:task:schedPerf.manager_id:mgrId@,
       @select:dim_prop:user_def:implied:task:schedPerf.obs:obsUnit@,                                    
       @select:metric:user_def:implied:SUM(CASE WHEN schedPerf.lookup_code='CRITLATE'  THEN 1 ELSE 0 END):critical_late@,
       @select:metric:user_def:implied:SUM(CASE WHEN schedPerf.lookup_code='PASTDUE'   THEN 1 ELSE 0 END):past_due@,
       @select:metric:user_def:implied:SUM(CASE WHEN schedPerf.lookup_code='SCHEDLATE' THEN 1 ELSE 0 END):scheduled_late@,
       @select:metric:user_def:implied:SUM(CASE WHEN schedPerf.lookup_code='ONTIME'    THEN 1 ELSE 0 END):on_time@
FROM   
(SELECT DISTINCT
        inv.id as inv_id,
        t.prid task_id,         
        category.lookup_code,
        category.name cat_name,
        category.name desc_name,
        @DBUSER@.COP_DATE_TRUNC_FCT(temp1.as_of_date) as_of_date,
        temp2.number_of_days,
        temp3.manager_id,
        temp4.obs
 FROM   inv_investments inv
 INNER  JOIN  inv_projects prj 
        ON    prj.prid = inv.id
        AND   prj.is_template <> 1
        AND   prj.is_program <> 1
 INNER  JOIN (SELECT @SELECT:PARAM:USER_DEF:DATE:AS_OF_DATE@ FROM dual WHERE 1=1) temp1 ON 1=1 
 INNER  JOIN (SELECT @SELECT:PARAM:USER_DEF:INTEGER:NUMBER_OF_DAYS@ FROM dual WHERE 1=1) temp2 ON 1=1  
 INNER  JOIN (SELECT @SELECT:PARAM:USER_DEF:INTEGER:MANAGER_ID@ FROM dual WHERE 1=1) temp3 ON 1=1 
 LEFT   OUTER JOIN (SELECT @SELECT:PARAM:USER_DEF:INTEGER:OBS@ FROM dual WHERE 1=1) temp4 ON 1=1 
 INNER  JOIN  prtask t 
        ON    t.prprojectid = inv.id
        AND   t.pristask <> 0
        AND   t.prismilestone <> 1
        AND   t.prstatus <> 2
 INNER  JOIN  cop_tsk_days_late_v tsk_d
        ON    t.prid = tsk_d.task_id
        AND   tsk_d.days_late > 0 
 LEFT   OUTER JOIN cmn_lookups_v category 
              ON   category.lookup_type = 'COP_SCHEDULE_STATUS' 
              AND  category.language_code = @WHERE:PARAM:LANGUAGE@
              AND  category.lookup_code = CASE WHEN t.priscritical = 1  
                                                    THEN 'CRITLATE'
                                               WHEN t.priscritical <> 1 AND (@DBUSER@.COP_CALC_FINISH_FCT(t.prfinish) < @DBUSER@.COP_DATE_TRUNC_FCT(@SYSDATE@)) 
                                                    THEN 'PASTDUE'
                                               WHEN t.priscritical <> 1 AND (@DBUSER@.COP_CALC_FINISH_FCT(t.prfinish) >= @DBUSER@.COP_DATE_TRUNC_FCT(@SYSDATE@))
                                                    THEN 'SCHEDLATE'
                                               ELSE 'ONTIME' 
                                          END                          
 LEFT   OUTER JOIN prj_obs_associations assoc 
              ON   inv.id = assoc.record_id
              AND  @UPPER@(assoc.table_name) = 'SRM_PROJECTS'
 LEFT   OUTER JOIN prj_obs_units_flat flat 
              ON   assoc.unit_id = flat.unit_id		  
 WHERE  inv.is_active <> 0
 AND   (@DBUSER@.COP_CALC_FINISH_FCT(t.prfinish) 
              BETWEEN  (@NVL@(temp1.as_of_date,@SYSDATE@) - @NVL@(temp2.number_of_days,45)) 
                  AND  (@NVL@(temp1.as_of_date,@SYSDATE@) + @NVL@(temp2.number_of_days,45))) 
 AND    inv.manager_id = @NVL@(temp3.manager_id,inv.manager_id)
 AND   (temp4.OBS IS NULL OR temp4.OBS = flat.branch_unit_id)
 AND    @WHERE:SECURITY:PROJECT:inv.id@ 
) schedPerf
WHERE  @FILTER@
GROUP  BY schedPerf.lookup_code,
          schedPerf.cat_name,
          schedPerf.desc_name,
          as_of_date,
          number_of_days,
          manager_id,
          obs
HAVING    @HAVING_FILTER@]]></nsql>
            <attribute id="category_code" required="false">
              
              
              
              
              <nls description="Classification Internal ID" languageCode="en" name="Classification Internal ID"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="category" required="false">
              
              
              
              
              <nls description="Classification" languageCode="en" name="Classification"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="cat_desc" required="false">
              
              
              
              
              <nls description="Classification Description" languageCode="en" name="Classification Description"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="asofdate" required="false">
              
              
              
              
              <nls description="As of Date" languageCode="en" name="As of Date"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="noofdays" required="false">
              
              
              
              
              <nls description="Number of Days" languageCode="en" name="Number of Days"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="mgrid" required="false">
              
              
              
              
              <nls description="Project Manager Internal ID" languageCode="en" name="Project Manager Internal ID"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="obsunit" required="false">
              
              
              
              
              <nls description="OBS Unit" languageCode="en" name="OBS Unit"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="critical_late" required="false">
              
              
              
              
              <nls description="Critical Late" languageCode="en" name="Critical Late"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="past_due" required="false">
              
              
              
              
              <nls description="Past Due" languageCode="en" name="Past Due"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="scheduled_late" required="false">
              
              
              
              
              <nls description="Scheduled Late" languageCode="en" name="Scheduled Late"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="on_time" required="false">
              
              
              
              
              <nls description="On Schedule" languageCode="en" name="On Schedule"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="param_obs" lookup="OBS_BROWSE_FLT_PRJ" required="false">
              
              
              
              
              <nls description="OBS Unit Filter" languageCode="en" name="OBS Unit Filter"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="param_as_of_date" required="false">
              
              
              
              
              <nls description="As of Date Filter" languageCode="en" name="As of Date Filter"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="param_manager_id" lookup="BROWSE_PROJMGR" required="false">
              
              
              
              
              <nls description="Project Manager Filter" languageCode="en" name="Project Manager Filter"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <attribute id="param_number_of_days" required="false">
              
              
              
              
              <nls description="Number of Days Filter" languageCode="en" name="Number of Days Filter"/>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
            </attribute>
            <links>
              <link action="copScheduleLinkable" code="cop.link.schedPerfDrillDown">
                
                
                
                
                <nls description="Schedule Performance Drill Down" languageCode="en" name="Schedule Performance Drill Down"/>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <linkParam dataRef="category_code" dataSource="data" paramCode="TaskCategory"/>
              </link>
            </links>
          </query>
        </queries>
      </contentPack>
    </NikuDataBus>